<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://chris-lesage.github.io/theme/stylesheet/styles.css">

  <link rel="stylesheet" type="text/css" href="http://chris-lesage.github.io/theme/pygments/github.min.css">
  

    <link href="http://chris-lesage.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Rigmarole Blog Atom">


    <link rel="shortcut icon" href="/theme/img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/theme/img/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Chris Lesage" />
<meta name="description" content="Do you use Maya follicles to pin objects to your geometry? Are you still doing it the old way, by creating a Hair System and then deleting all the parts you don’t need? Below I’ll share my simple Maya Python script that creates and pins a single follicle onto a nurbs surface. (Jump straight to the script.) I love using follicles. They adhere to a nurbs or poly surface and they maintain a good, predictable orientation in normal ..." />
<meta name="keywords" content="maya, pymel, python, rigtip, techart, tutorials">
<meta property="og:site_name" content="Rigmarole Blog"/>
<meta property="og:title" content="Manually Create a Single Maya Follicle in Python"/>
<meta property="og:description" content="Do you use Maya follicles to pin objects to your geometry? Are you still doing it the old way, by creating a Hair System and then deleting all the parts you don’t need? Below I’ll share my simple Maya Python script that creates and pins a single follicle onto a nurbs surface. (Jump straight to the script.) I love using follicles. They adhere to a nurbs or poly surface and they maintain a good, predictable orientation in normal ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://chris-lesage.github.io/character-rigging/manually-create-maya-follicle-in-python/"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2013-02-22 00:00:00-05:00"/>
<meta property="article:modified_time" content="2013-02-22 00:00:00-05:00"/>
<meta property="article:author" content="http://chris-lesage.github.io/pages/about/">
<meta property="article:section" content="character-rigging"/>
<meta property="article:tag" content="maya"/>
<meta property="article:tag" content="pymel"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="rigtip"/>
<meta property="article:tag" content="techart"/>
<meta property="article:tag" content="tutorials"/>
<meta property="og:image" content="">
  <title>Rigmarole Blog &ndash; Manually Create a Single Maya Follicle in Python</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://chris-lesage.github.io">
        <img src="http://chris-lesage.github.io/theme/img/logo_header.png" alt="" title=""><br>
        <img src="http://chris-lesage.github.io/theme/img/logo_text.png" alt="" title="">
      </a>
      <h1><a href="http://chris-lesage.github.io"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="/blog/">Blog</a></li>
              <li><a href="http://chris-lesage.github.io/pages/tech-artist-demoreel/">demoreel</a></li>
              <li><a href="http://chris-lesage.github.io/pages/about/">about</a></li>
              <li><a href="http://chris-lesage.github.io/pages/tools/">tools</a></li>
              <li><a href="http://chris-lesage.github.io/pages/now/">now</a></li>
        </ul>
      </nav>
      <ul class="social">
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <div class="article_title">
    <img src ='gears_64'>
    <h2><a href="http://chris-lesage.github.io/character-rigging/manually-create-maya-follicle-in-python/">Manually Create a Single Maya Follicle in&nbsp;Python</a></h2>
    <p>Posted on 2013-02-22 - category: <a href="http://chris-lesage.github.io/category/character-rigging/">character-rigging</a></p>
    </div>
  </header>

    <p>Do you use Maya follicles to pin objects to your geometry? Are you still doing it the old way, by creating a Hair System and then deleting all the parts you don&#8217;t need? Below I&#8217;ll share my simple Maya Python script that creates and pins a single follicle onto a nurbs surface. (<a href="#folliclescript">Jump straight to the script.</a>)</p>
<p>I love using follicles. They adhere to a nurbs or poly surface and they maintain a good, predictable orientation in normal and tangent space, which means they don&#8217;t shift or rotate and they don&#8217;t need additional up-vector constraints. It is a great and predictable way to pin things to your&nbsp;geometry.</p>
<h2>How you can use&nbsp;follicles:</h2>
<ul>
<li>Create a flip-free &#8220;Ribbon <span class="caps">IK</span>&#8221; for spines, tentacles or cartoon limbs without needing a ton of up-vector&nbsp;constraints!</li>
<li>Attach a boat to a flowing water&nbsp;surface</li>
<li>Rivet buttons or patches onto&nbsp;clothing</li>
<li>Rivet some controllers to one layer of your character, so you can adjust a second layer. (Imagine a character with a scarf around their&nbsp;neck.)</li>
<li>Slide facial controls along an underlying &#8220;skull&#8221; object or create other skin sliding&nbsp;effects.</li>
<li>Measure the distance between two points (even if there is no vertex where you want to measure) on geometry, even if is being deformed in many different&nbsp;ways.</li>
<li>Arvid Schneider&#8217;s video shows us how we can use follicles as a great way to pin things to different types of meshes <a href="http://lesterbanks.com/2012/08/using-maya-hair-follicles-for-parenting-constraining-geometry-to-a-surface/">http://lesterbanks.com/2012/08/using-maya-hair-follicles-for-parenting-constraining-geometry-to-a-surface/</a></li>
</ul>
<p>In the past, I would create the follicles by creating a hair system and then delete everything except the follicles. When I went to script this, I found it was difficult to access the hair system with Python and PyMEL. So instead I wrote this PyMEL snippet which lets you create a single follicle manually. It sets up all the same connections but the hair system never gets created. (I am only supporting nurbs surfaces in this script, because if you use polygons, you need to have UVs on the mesh, and the follicle will act unpredictably depending on how clean your UVs&nbsp;are.) </p>
<h2>Setting Things&nbsp;Up</h2>
<p>Before we get to the script, I just want to point out how I use this. I <strong>never</strong> pin follicles directly on to my polygon characters.&nbsp;Why?</p>
<ul>
<li>Because if your geometry changes, you have to disconnect and then reconnect&nbsp;everything</li>
<li>If the UVs get changed, the position of the follicle will change. If your UVs aren&#8217;t clean, predicting where the follicle will travel is nearly&nbsp;impossible.</li>
<li>By using nurbs, you have a nice clean 0 to 1 <span class="caps">UV</span> space, which is nice and easy for setting up Driven Keys or distributing multiple follicles in an even row. (Plus you know that 0.5 is precisely the&nbsp;middle.)</li>
</ul>
<p>So what I do instead is&nbsp;this:</p>
<p><img alt="using_nurbs_for_follicle_placement" src="http://chrislesage.com/wp-content/uploads/2013/02/using_nurbs_for_follicle_placement-e1382696561574-286x300.jpg" /></p>
<ol>
<li>create a small nurbs plane, big enough that will cover the area I want to work&nbsp;with.</li>
<li>give it 2-6 patches, depending on how much it will have to deform. (2 often&nbsp;works.)</li>
<li>Bend it and place it so it roughly matches the shape of your character&#8217;s&nbsp;geometry.</li>
<li>Skin it with the same joints as your character and copy weights. (If you have any other deformers or blendshapes, you will need to match those too.) This way you can safely and easily change your character&#8217;s geometry without losing all your follicle work. (This is a common occurrence in production. Never assume your geometry is final.)<a id="folliclescript"></a></li>
</ol>
<h2>Here is the&nbsp;script</h2>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymel.core</span> <span class="kn">as</span> <span class="nn">pm</span>

<span class="k">def</span> <span class="nf">create_follicle</span><span class="p">(</span><span class="n">oNurbs</span><span class="p">,</span> <span class="n">uPos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">vPos</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="c1"># manually place and connect a follicle onto a nurbs surface.</span>
    <span class="k">if</span> <span class="n">oNurbs</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;transform&#39;</span><span class="p">:</span>
        <span class="n">oNurbs</span> <span class="o">=</span> <span class="n">oNurbs</span><span class="o">.</span><span class="n">getShape</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">oNurbs</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;nurbsSurface&#39;</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="s1">&#39;Warning: Input must be a nurbs surface.&#39;</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="c1"># create a name with frame padding</span>
    <span class="n">pName</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">oNurbs</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span><span class="s1">&#39;follicle&#39;</span><span class="p">,</span><span class="s1">&#39;#&#39;</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>

    <span class="n">oFoll</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">createNode</span><span class="p">(</span><span class="s1">&#39;follicle&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">pName</span><span class="p">)</span>
    <span class="n">oNurbs</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">oFoll</span><span class="o">.</span><span class="n">inputSurface</span><span class="p">)</span>
    <span class="c1"># if using a polygon mesh, use this line instead.</span>
    <span class="c1"># (The polygons will need to have UVs in order to work.)</span>
    <span class="c1">#oMesh.outMesh.connect(oFoll.inMesh)</span>

    <span class="n">oNurbs</span><span class="o">.</span><span class="n">worldMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">oFoll</span><span class="o">.</span><span class="n">inputWorldMatrix</span><span class="p">)</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">outRotate</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">oFoll</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span><span class="o">.</span><span class="n">rotate</span><span class="p">)</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">outTranslate</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">oFoll</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">)</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">parameterU</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">uPos</span><span class="p">)</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">parameterV</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">vPos</span><span class="p">)</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
    <span class="n">oFoll</span><span class="o">.</span><span class="n">getParent</span><span class="p">()</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">oFoll</span>
</pre></div>


<p><strong>Important:</strong> To use the script, select a nurbs surface in Maya and run this line. Set the U and V parameters as you&nbsp;wish:</p>
<div class="highlight"><pre><span></span><span class="n">oFoll</span> <span class="o">=</span> <span class="n">create_follicle</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">selected</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>


<p>If you want to create a bunch of follicles evenly spread along a long nurbs plane, use something like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="n">myObject</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">selected</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">howManyFollicles</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">howMany</span><span class="p">):</span>
    <span class="n">oFoll</span> <span class="o">=</span> <span class="n">create_follicle</span><span class="p">(</span><span class="n">myObject</span><span class="p">,</span> <span class="n">i</span><span class="o">/</span><span class="p">(</span><span class="n">howManyFollicles</span><span class="o">-</span><span class="mf">1.00</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>


<h2>Thanks For&nbsp;Reading</h2>
<p>Share in the comments if you have used follicles to solve your rigging or animation&nbsp;problems!</p>
<hr />
<h2>Comments</h2>
<p><strong><a href="#64" title="2013-02-26 13:09:00">Chris Lesage</a>:</strong> Hi Marco, Thanks. Some of the rivet plugins I&#8217;ve seen come with very nice features too. I&#8217;ve used hundreds of follicles in some rigs (for a long tentacled creature for example) and I&#8217;ve found that by bypassing the Hair System I don&#8217;t see any significant performance hit. And all of the extra attributes associated with hair can be deleted since they aren&#8217;t connected to anything. (except U and&nbsp;V.)</p>
<p><strong><a href="#63" title="2013-02-26 07:49:44">Marco Giordano</a>:</strong> Well done sir! But If I can I never use follicles , follicles comes with a crazy loads of features from hair system which require extra computation , of course It all depends how many you need but 99% of the time I use custom rivets I wrote both for mesh and nurbs surface so I am sure It s only doing the task is supposed to. But again well done the script is really userfull for people that cannot rely on&nbsp;plugins</p>
<p><strong><a href="#67" title="2013-05-06 23:24:48">Chris Lesage</a>:</strong> Thanks Brad! I had never noticed the Popup Menus option there! That is a nice way to quickly build up some flexible menus, without getting into designing a little <span class="caps">UI</span> or popup&nbsp;dialog.</p>
<p><strong><a href="#66" title="2013-05-02 03:14:58">Brad Clark</a>:</strong> This is a great little script and a perfect tool to use this shelf #rigtip with. I took the code, added a double click to run the single follicles build and then added some right click options to add diffrent set of follicles to selected surface. https://vimeo.com/45485411 Thanks for the script Chris, Hope you are&nbsp;well.</p>
  
  <div class="tag-cloud">
    <p>
      <a href="http://chris-lesage.github.io/tag/maya.html">maya</a>
      <a href="http://chris-lesage.github.io/tag/pymel.html">pymel</a>
      <a href="http://chris-lesage.github.io/tag/python.html">python</a>
      <a href="http://chris-lesage.github.io/tag/rigtip.html">rigtip</a>
      <a href="http://chris-lesage.github.io/tag/techart.html">techart</a>
      <a href="http://chris-lesage.github.io/tag/tutorials.html">tutorials</a>
    </p>
  </div>
</article>

    <footer>
        <nav>
          <a href="http://chris-lesage.github.io">Home</a>
          <a href="http://chris-lesage.github.io/archives.html">Archives</a>
          <a href="http://chris-lesage.github.io/categories.html">Categories</a>
          <a href="http://chris-lesage.github.io/feeds/all.atom.xml">Atom</a>
        </nav>

      <p>&copy; 2016 Chris Lesage - Rigmarole Blog&#12288;&mdash;&#12288;<a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>

    </footer>
  </main>





<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "Manually Create a Single Maya Follicle in Python",
  "headline": "Manually Create a Single Maya Follicle in Python",
  "datePublished": "2013-02-22 00:00:00-05:00",
  "dateModified": "2013-02-22 00:00:00-05:00",
  "author": {
    "@type": "Person",
    "name": "Chris Lesage",
    "url": "http://chris-lesage.github.io/pages/about/"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "http://chris-lesage.github.io/character-rigging/manually-create-maya-follicle-in-python/",
  "description": "Do you use Maya follicles to pin objects to your geometry? Are you still doing it the old way, by creating a Hair System and then deleting all the parts you don’t need? Below I’ll share my simple Maya Python script that creates and pins a single follicle onto a nurbs surface. (Jump straight to the script.) I love using follicles. They adhere to a nurbs or poly surface and they maintain a good, predictable orientation in normal ..."
}
</script></body>
</html>